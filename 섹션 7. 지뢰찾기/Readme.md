# 섹션 7. 지뢰찾기

## 1. Context API 소개와 지뢰찾기

- MineSearch => 메인 컴포넌트
- Table/Td/Tr => 지뢰 칸을 구성하는 컴포넌트
- Form => 가로/세로/지뢰개수 입력할 form 컴포넌트
  - onClickBtn => contextAPI 적용
- 불필요한 렌더링을 막기 위한 useCallback 기억!
-

## 2. createContext와 Provider

- createContext(기본값)
  - 기본값은 기본 데이터와 dispatch 함수를 가진다.
- Context를 적용하고 싶은 태그를 Context.Provider 태그로 감싸주고 value 프로퍼티에 state와 dispatch를 넣어 하위 컴포넌트에 전달해줄 수 있게 된다.
- 가져와서 사용할때는 useContext를 사용해서 value를 사용한다.
- 매번 새로운 객체를 생성해서 provider가 값을 전달해줄 수 있기 때문에, 따로 useMemo를 활용해서 캐싱한 값을 Provider로 감싼 태그에 전달해줘야 한다.
- 지뢰칸을 클릭했을때(좌/우 클릭)에 따른 상태값도 구분지어줘야 한다.

## 3. useContext 사용해 지뢰 칸 렌더링

- useContext로 props없이 해당 지뢰 및 칸 정보를 받아올 수 있다. 이를 통해 Table.jsx에서 table을 그릴 수 있게 된다.
- rowIndex는 각 태그의 순서이므로 props로 전달.
- 각 지뢰의 상태에 맞게 보여줄 디자인, 텍스트 정의

## 4. 왼쪽 오른쪽 클릭 로직 작성하기

- 왼쪽 클릭할때 dispatch를 통해서 해당 칸의 좌표를 action에 포함해주고 그 값에 맞게 그 칸에 적절한 이펙트가 나타날 수 있도록 구현(펑, 오픈)
- 오른쪽 클릭할때는 물음표, flag(느낌표)가 나타날 수 있도록 하고 해당 칸을 클릭할때는 아무 동작도 하지 않게끔 구현
  - 이때 이벤트가 발생하면 안되니까 e.preventDefault()를 해준다.
- halted라는 변수는 게임을 멈춰줄 변수(state에 추가)

## 5. 지뢰 개수 표시하기

- 빈칸이 여러개 붙어있는 경우 한번에 열릴 수 있도록, 빈칸 주변에 지뢰가 있을 경우 주변에 지뢰가 몇개가 있는지 알려줄 수 있도록 구현
- 제일 가장자리에 있는 칸의 여부도 체크하면서 지뢰 여부를 검사해야 한다.

## 6. 빈 칸들 한 번에 열기

- 일반 자바스크립트와 구현이 상이
- call stack이 터지지 않도록 구현을 신경쓰면서 진행해야 한다.
- 주변 카드를 클릭해주는 함수를 구현한다.
- 그렇게 지금 좌표를 기준으로 숫자가 적혀있지 않은 칸이 있는지를 체크하고 이를 통해 연결된 빈칸들을 모두 열게 된다.
- Question 왜 좌우는 값이 있는지 검사안하는가?
  - filtering 과정을 통해서 undefined를 제거하므로

## 7. 승리 조건 체크와 타이머

- 승리 조건
  - 칸을 전체칸 - 지뢰 수 만큼 열었을 때 성공인 여부만 체크하면 된다.
  - 연 칸을 세어줄 변수 count를 선언하고 하나씩 더해주되 지뢰를 찾으면 다시 0으로 돌리는 함수에 포함시켜서 전체 state에서 관리한다.
  - 중복되어 체크되는 부분이 없는지도 잘 챙겨서 로직을 구현하는 것이 중요하다.
  - 재현하기 어려운 버그가 제일 어려워 ㅠㅠㅠ 인정합니다... 실무에서는 간헐적으로 발생하는 QA 이슈를 해결하기 가장 어려운거 같아요
- 문제가 될때는 console을 잘 찍어보고, 오타 체크 잘하고, 들어가야될 데이터의 형식을 잘 지정하고, 값을 초기화 해줘야하는 순간에 초기화를 꼼꼼하게 적용해야 한다.

- 타이머
  - 시작버튼 트리거를 통해 시간이 더해질 수 있도록 구현

## 8. Context api 최적화

- context api로 인해서 전체가 리렌더링이 되는 부분이 많으면 그만큼 성능이 좋지 못하다는 의미이므로, useMemo와 memo를 활용해서 필요한 것들만 리렌더링 되도록 지정해주는 것이 중요하다.
- memo는 하위 컴포넌트도 적용이 되어 있어야 상위 컴포넌트에도 적용이 가능하다는 부분 인식하기.
- 한칸을 눌렀고 그로 인해 특정 칸들만 변화가 있어야 하는데 전체적으로 모두 리렌더링 되는 경우가 있다. 이에 대해서도 적절한 위치에서 렌더링을 막아줄 수 있는 조치를 취해야 한다.
  - 참고로 Dev Tools를 사용할 때 전체가 모두 리렌더링 되는것처럼 깜빡거리는 모습이 나올수도 있지만, 실제로 return문에서 UI를 렌더링 하는 부분이 다시 리렌더링 되는지를 체크하기 위해서는 해당 태그를 클릭했을 때 발생하는 이벤트가 마찬가지로 여러번 되는지를 체크하면 된다.
- depth가 있는 자식 컴포넌트도 부모 컴포넌트에 정의되어 있는 state를 한번에 받기 위해서 Context API를 사용하고 있고 이를 활용할 때는 최적화도 늘 신경써야 한다는 부분을 기억해야 한다.
